<div class="form-container">

    <div class="div-header">
        <button mat-icon-button (click)="goBack()" aria-label="Voltar">
            <mat-icon>arrow_back</mat-icon>
        </button>
        <h1 class="page-title">Resultados da pesquisa</h1>
    </div>

    <section class="form-section mat-elevation-z1">
        <!-- Título e Disciplina -->
        <div class="form-info" *ngIf="research">
            <p><strong>Título:</strong> {{ research.title }}</p>
            <p><strong>Disciplina:</strong> {{ research.course.name }}</p>
            <p><strong>Professor:</strong> {{ research.course.teacher.name }}</p>
            <p><strong>Encerrada em:</strong> {{ research.updatedAt | date: 'dd/MM/yyyy HH:mm' }}</p>
        </div>

        <!-- Questões e Gráficos -->
        <div class="questions-section" *ngIf="research && research.questions">

            <!-- Resumo Geral -->
            <div class="summary-section" *ngIf="research && research.questions">
                <h2 class="section-title">Resumo Geral</h2>
                <div class="summary-cards">
                    <mat-card class="summary-card">
                        <mat-card-header>
                            <mat-card-title>Total de Questões</mat-card-title>
                        </mat-card-header>
                        <mat-card-content>
                            <div class="summary-value">{{ research.questions.length }}</div>
                        </mat-card-content>
                    </mat-card>

                    <mat-card class="summary-card">
                        <mat-card-header>
                            <mat-card-title>Total de Participantes</mat-card-title>
                        </mat-card-header>
                        <mat-card-content>
                            <div class="summary-value">{{ getTotalParticipants() }}</div>
                        </mat-card-content>
                    </mat-card>
                </div>
            </div>

            <h2 class="section-title">Resultados das Questões</h2>
            <div class="question-container" *ngFor="let question of research.questions; trackBy: trackByQuestionId">
                <div class="question-header">
                    <h3 class="question-title">{{ question.text }}</h3>
                    <div class="question-stats">
                        <span class="total-answers">
                            <mat-icon>people</mat-icon>
                            Total de respostas: {{ question.totalAnswers }}
                        </span>
                        <span class="question-type" [ngClass]="'type-' + question.answerType.toLowerCase()">
                            {{ question.answerType === 'ESCALA_NUMERICA' ? 'Escala Numérica' : 'Sim/Não' }}
                        </span>
                    </div>
                </div>

                <!-- Gráfico -->
                <div class="chart-container">
                    <canvas baseChart [data]="getChartData(question.id)" [options]="getChartOptions(question.id)"
                        [type]="getChartType(question.id)" class="chart">
                    </canvas>
                </div>
            </div>
        </div>

        <!-- Botões -->
        <div class="form-actions">
            <button mat-raised-button color="primary" type="button" (click)="goBack()">
                <mat-icon>arrow_back</mat-icon> Voltar
            </button>
        </div>
    </section>
</div>